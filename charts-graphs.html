<!DOCTYPE html>
<html>
<head>
    <title>Smart Invest - Charts & Graphs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #chartsGraphs {
            padding: 20px;
            text-align: center;
        }

        #performanceGraph {
            margin: 20px auto;
            max-width: 600px;
        }

        #graphControls {
            margin: 20px 0;
            text-align: center;
        }

        #stockGrid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .stock-button, .portfolio-option {
            padding: 10px 15px;
            font-size: 1em;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #202020;
            color: #e0e0e0;
            cursor: pointer;
        }

        .stock-button.selected, .portfolio-option.selected {
            background-color: #64ffda;
            color: #181818;
        }

        .portfolio {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin: 15px auto;
            padding: 10px;
            max-width: 400px;
            text-align: left;
        }

        .delete-icon {
            margin: 5px;
            padding: 5px 10px;
            font-size: 0.9em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <section id="chartsGraphs">
        <h1>Create and View Your Portfolio</h1>

        <!-- Stock Selection -->
        <div id="stockSelection">
            <p>Select up to 10 stocks from the SP500:</p>
            <div id="stockGrid">
                <!-- Stock options dynamically added -->
            </div>
        </div>
        <button id="createPortfolio">Create Portfolio</button>

        <!-- Saved Portfolios -->
        <div id="savedPortfolios">
            <h2>Saved Portfolios</h2>
        </div>

        <!-- Interactive Graph -->
        <h2>Portfolio Performance</h2>
        <canvas id="performanceGraph"></canvas>
        <div id="graphControls">
            <label for="timePeriod">Select Time Period:</label>
            <select id="timePeriod">
                <option value="1m">1 Month</option>
                <option value="3m">3 Months</option>
                <option value="6m">6 Months</option>
                <option value="1y">1 Year</option>
            </select>
            <div id="portfolioOptions"></div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const stockGrid = document.getElementById("stockGrid");
            const createPortfolioButton = document.getElementById("createPortfolio");
            const savedPortfoliosDiv = document.getElementById("savedPortfolios");
            const portfolioOptionsDiv = document.getElementById("portfolioOptions");
            const timePeriodSelector = document.getElementById("timePeriod");
            const ctx = document.getElementById("performanceGraph").getContext("2d");

            const sp500Stocks = [
                "AAPL", "MSFT", "GOOGL", "AMZN", "TSLA", "META", "NFLX", "NVDA", "DIS", "JPM", "WMT", "PFE", "XOM", "KO", "PG",
                "HD", "V", "BAC", "UNH", "INTC"
            ];
            const stockMockData = {};
            sp500Stocks.forEach((stock) => {
                stockMockData[stock] = {
                    "1m": Array(3).fill(0).map(() => Math.random() * 20 + 90), // Mock data
                    "3m": Array(3).fill(0).map(() => Math.random() * 30 + 80),
                    "6m": Array(5).fill(0).map(() => Math.random() * 50 + 70),
                    "1y": Array(4).fill(0).map(() => Math.random() * 60 + 60),
                };
            });

            const dummyData = {
                SP500: { "1m": [100, 102, 104], "3m": [100, 105, 108], "6m": [100, 110, 115], "1y": [100, 120, 130] },
                Premium: { "1m": [100, 105, 110], "3m": [100, 115, 125], "6m": [100, 120, 130], "1y": [100, 140, 150] },
            };

            const selectedStocks = new Set();
            const activePortfolios = new Set(["SP500", "Premium"]); // Default portfolios

            let performanceGraph = new Chart(ctx, {
                type: "line",
                data: {
                    labels: [],
                    datasets: [],
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: "Time Period" } },
                        y: { title: { display: true, text: "Performance (%)" } },
                    },
                },
            });

            sp500Stocks.forEach((ticker) => {
                const button = document.createElement("button");
                button.textContent = ticker;
                button.className = "stock-button";
                stockGrid.appendChild(button);

                button.addEventListener("click", () => {
                    if (selectedStocks.has(ticker)) {
                        selectedStocks.delete(ticker);
                        button.classList.remove("selected");
                    } else if (selectedStocks.size < 10) {
                        selectedStocks.add(ticker);
                        button.classList.add("selected");
                    } else alert("You can select up to 10 stocks.");
                });
            });

            createPortfolioButton.addEventListener("click", () => {
                const portfolioName = prompt("Enter portfolio name:");
                if (!portfolioName) return alert("Portfolio name is required.");
                const portfolioDiv = document.createElement("div");
                portfolioDiv.className = "portfolio";
                portfolioDiv.innerHTML = `<h3>${portfolioName}</h3><ul>${[...selectedStocks].map((s) => `<li>${s}</li>`).join("")}</ul>`;
                const deleteIcon = document.createElement("button");
                deleteIcon.textContent = "🗑️";
                deleteIcon.className = "delete-icon";
                deleteIcon.addEventListener("click", () => {
                    savedPortfoliosDiv.removeChild(portfolioDiv);
                    activePortfolios.delete(portfolioName);
                    updateGraph();
                });
                portfolioDiv.appendChild(deleteIcon);
                savedPortfoliosDiv.appendChild(portfolioDiv);
                addPortfolioOption(portfolioName, [...selectedStocks]);
            });

            function addPortfolioOption(name, stocks) {
                const button = document.createElement("button");
                button.textContent = name;
                button.className = "portfolio-option";
                portfolioOptionsDiv.appendChild(button);

                button.addEventListener("click", () => {
                    if (activePortfolios.has(name)) {
                        activePortfolios.delete(name);
                        button.classList.remove("selected");
                    } else {
                        activePortfolios.add(name);
                        button.classList.add("selected");
                    }
                    updateGraph();
                });
            }

            const updateGraph = () => {
                const selectedPeriod = timePeriodSelector.value;
                performanceGraph.data.labels = Array(stockMockData["AAPL"][selectedPeriod].length).fill(0).map((_, i) => `Point ${i + 1}`);
                performanceGraph.data.datasets = Array.from(activePortfolios).map((portfolioName) => {
                    const data =
                        dummyData[portfolioName]?.[selectedPeriod] ||
                        Array.from(selectedStocks).reduce(
                            (avg, stock) => avg.map((v, i) => v + stockMockData[stock][selectedPeriod][i]),
                            Array(stockMockData["AAPL"][selectedPeriod].length).fill(0)
                        ).map((sum) => sum / selectedStocks.size);

                    return {
                        label: portfolioName,
                        data,
                        borderColor: portfolioName === "SP500" ? "#ff6b6b" : portfolioName === "Premium" ? "#64ffda" : "#4db8ff",
                        backgroundColor: portfolioName === "SP500" ? "rgba(255, 107, 107, 0.2)" : "rgba(100, 255, 218, 0.2)",
                        fill: true,
                    };
                });
                performanceGraph.update();
            };

            timePeriodSelector.addEventListener("change", updateGraph);

            // Add SP500 and Premium options
            ["SP500", "Premium"].forEach((name) => addPortfolioOption(name, []));

            updateGraph();
        });
    </script>
</body>
</html>
